@inherits LayoutComponentBase
@inject AuthService AuthService
@inject NavigationManager Navigation

<div class="min-h-screen bg-gray-50">
    @* 頂部導覽列 *@
    <nav class="bg-white shadow-sm border-b border-gray-200">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16">
                <div class="flex items-center">
                    <a href="/" class="text-xl font-bold text-gray-800 hover:text-blue-600 transition">
                        📋 工作紀錄系統
                    </a>
                    <AuthorizeView>
                        <Authorized Context="navAuth">
                            <div class="hidden sm:flex sm:ml-8 sm:space-x-4">
                                <NavLink href="/" class="nav-link" Match="NavLinkMatch.All">工作紀錄</NavLink>
                                <NavLink href="/worklogs/create" class="nav-link">新增紀錄</NavLink>
                                <NavLink href="/todos" class="nav-link">待辦事項</NavLink>
                                <NavLink href="/data-export" class="nav-link">資料匯出</NavLink>
                                <NavLink href="/data-import" class="nav-link">資料匯入</NavLink>
                                <AuthorizeView Roles="Admin">
                                    <Authorized Context="adminAuth">
                                        <NavLink href="/admin" class="nav-link">系統管理</NavLink>
                                    </Authorized>
                                </AuthorizeView>
                            </div>
                        </Authorized>
                    </AuthorizeView>
                </div>

                <div class="flex items-center space-x-4">
                    <AuthorizeView>
                        <Authorized Context="userAuth">
                            <span class="text-sm text-gray-600 hidden sm:inline">@userAuth.User.Identity?.Name</span>
                            @if (userAuth.User.IsInRole("Admin"))
                            {
                                <span class="inline-flex items-center px-2 py-0.5 rounded text-xs font-medium bg-blue-100 text-blue-800">
                                    管理員
                                </span>
                            }
                            <button @onclick="HandleLogout"
                                    class="text-sm text-gray-500 hover:text-red-600 transition">
                                登出
                            </button>
                        </Authorized>
                        <NotAuthorized>
                            <NavLink href="/login" class="text-sm text-blue-600 hover:text-blue-800">登入</NavLink>
                            <NavLink href="/register" class="text-sm text-gray-500 hover:text-gray-700">註冊</NavLink>
                        </NotAuthorized>
                    </AuthorizeView>
                </div>
            </div>

            @* 手機版選單 *@
            <AuthorizeView>
                <Authorized Context="mobileAuth">
                    <div class="sm:hidden flex space-x-2 pb-3 overflow-x-auto">
                        <NavLink href="/" class="nav-link-mobile" Match="NavLinkMatch.All">工作紀錄</NavLink>
                        <NavLink href="/worklogs/create" class="nav-link-mobile">新增</NavLink>
                        <NavLink href="/todos" class="nav-link-mobile">待辦</NavLink>
                        <NavLink href="/data-export" class="nav-link-mobile">匯出</NavLink>
                        <NavLink href="/data-import" class="nav-link-mobile">匯入</NavLink>
                        <AuthorizeView Roles="Admin">
                            <Authorized Context="mobileAdminAuth">
                                <NavLink href="/admin" class="nav-link-mobile">管理</NavLink>
                            </Authorized>
                        </AuthorizeView>
                    </div>
                </Authorized>
            </AuthorizeView>
        </div>
    </nav>

    @* 主要內容區 *@
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
        @Body
    </main>
</div>

@code {
    private async Task HandleLogout()
    {
        await AuthService.Logout();
        Navigation.NavigateTo("/login");
    }
}

<style>
    .nav-link {
        color: #6b7280;
        padding: 0.5rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.875rem;
        font-weight: 500;
        transition: all 0.15s;
        text-decoration: none;
    }
    .nav-link:hover { color: #2563eb; background-color: #eff6ff; }
    .nav-link.active { color: #2563eb; background-color: #eff6ff; }

    .nav-link-mobile {
        color: #6b7280;
        padding: 0.375rem 0.75rem;
        border-radius: 0.375rem;
        font-size: 0.8rem;
        white-space: nowrap;
        text-decoration: none;
    }
    .nav-link-mobile:hover, .nav-link-mobile.active { color: #2563eb; background-color: #eff6ff; }
</style>
