{
  "openapi": "3.0.1",
  "info": {
    "title": "WorkLog API",
    "version": "v1",
    "description": "完整 OpenAPI 規格（由程式碼掃描產生的摘要版，含主要端點與 DTO）。"
  },
  "servers": [{ "url": "http://localhost:5000", "description": "Local" }],
  "components": {
    "securitySchemes": {
      "bearerAuth": { "type": "http", "scheme": "bearer", "bearerFormat": "JWT" }
    },
    "schemas": {
      "LoginRequest": { "type": "object", "properties": { "username": { "type": "string" }, "password": { "type": "string" } }, "required": ["username","password"] },
      "RegisterRequest": { "type": "object", "properties": { "username": { "type": "string" }, "email": { "type": "string" }, "password": { "type": "string" } }, "required": ["username","email","password"] },
      "RefreshTokenRequest": { "type": "object", "properties": { "refreshToken": { "type": "string" } }, "required": ["refreshToken"] },
      "AuthResponse": { "type": "object", "properties": { "accessToken": { "type": "string" }, "refreshToken": { "type": "string" }, "expiresAt": { "type": "string", "format": "date-time" }, "user": { "$ref": "#/components/schemas/UserInfo" } } },
      "UserInfo": { "type": "object", "properties": { "id": { "type": "integer" }, "username": { "type": "string" }, "email": { "type": "string" }, "role": { "type": "string" } } },
      "PagedResponse": { "type": "object", "properties": { "items": { "type": "array", "items": { "type": "object" } }, "totalCount": { "type": "integer" }, "page": { "type": "integer" }, "pageSize": { "type": "integer" }, "totalPages": { "type": "integer" } } },
      "LookupItemDto": { "type": "object", "properties": { "id": { "type": "integer" }, "name": { "type": "string" }, "isActive": { "type": "boolean" }, "sortOrder": { "type": "integer" } } },
      "WorkLogRequest": { "type": "object", "properties": { "title": { "type": "string" }, "content": { "type": "string" }, "recordDate": { "type": "string", "format": "date" }, "workHours": { "type": "number" }, "projectId": { "type": "integer" }, "processStatusId": { "type": "integer" }, "departmentIds": { "type": "array", "items": { "type": "integer" } }, "workTypeIds": { "type": "array", "items": { "type": "integer" } } }, "required": ["title","content","recordDate"] },
      "WorkLogResponse": { "type": "object", "properties": { "id": { "type": "integer" }, "title": { "type": "string" }, "content": { "type": "string" }, "recordDate": { "type": "string", "format": "date" }, "workHours": { "type": "number" }, "project": { "$ref": "#/components/schemas/LookupItemDto" }, "processStatus": { "$ref": "#/components/schemas/LookupItemDto" }, "departments": { "type": "array", "items": { "$ref": "#/components/schemas/LookupItemDto" } }, "workTypes": { "type": "array", "items": { "$ref": "#/components/schemas/LookupItemDto" } } } },
      "TodoRequest": { "type": "object", "properties": { "title": { "type": "string" }, "description": { "type": "string" }, "dueDate": { "type": "string", "format": "date" }, "priority": { "type": "string" }, "categoryId": { "type": "integer" }, "subTasks": { "type": "array", "items": { "type": "object", "properties": { "title": { "type": "string" }, "sortOrder": { "type": "integer" } } } } }, "required": ["title"] },
      "TodoItemResponse": { "type": "object", "properties": { "id": { "type": "integer" }, "title": { "type": "string" }, "description": { "type": "string" }, "dueDate": { "type": "string", "format": "date" }, "status": { "type": "string" }, "priority": { "type": "string" }, "createdAt": { "type": "string", "format": "date-time" }, "updatedAt": { "type": "string", "format": "date-time" }, "completedAt": { "type": "string", "format": "date-time" }, "category": { "$ref": "#/components/schemas/TodoCategoryResponse" }, "subTasks": { "type": "array", "items": { "$ref": "#/components/schemas/TodoSubTaskResponse" } }, "attachments": { "type": "array", "items": { "$ref": "#/components/schemas/TodoAttachmentResponse" } }, "comments": { "type": "array", "items": { "$ref": "#/components/schemas/TodoCommentResponse" } } } },
      "TodoItemListResponse": { "type": "object", "properties": { "id": { "type": "integer" }, "title": { "type": "string" }, "dueDate": { "type": "string", "format": "date" }, "status": { "type": "string" }, "priority": { "type": "string" }, "createdAt": { "type": "string", "format": "date-time" }, "category": { "$ref": "#/components/schemas/TodoCategoryResponse" }, "subTaskCount": { "type": "integer" }, "completedSubTaskCount": { "type": "integer" }, "attachmentCount": { "type": "integer" }, "commentCount": { "type": "integer" } } },
      "TodoDashboardResponse": { "type": "object", "properties": { "pendingCount": { "type": "integer" }, "inProgressCount": { "type": "integer" }, "completedCount": { "type": "integer" }, "dueTodayCount": { "type": "integer" }, "dueThisWeekCount": { "type": "integer" }, "overdueCount": { "type": "integer" }, "dueTodayItems": { "type": "array", "items": { "$ref": "#/components/schemas/TodoItemListResponse" } }, "overdueItems": { "type": "array", "items": { "$ref": "#/components/schemas/TodoItemListResponse" } } } },
      "TodoSubTaskResponse": { "type": "object", "properties": { "id": { "type": "integer" }, "title": { "type": "string" }, "isCompleted": { "type": "boolean" }, "sortOrder": { "type": "integer" }, "createdAt": { "type": "string", "format": "date-time" } } },
      "TodoAttachmentResponse": { "type": "object", "properties": { "id": { "type": "integer" }, "fileName": { "type": "string" }, "fileSize": { "type": "integer" }, "contentType": { "type": "string" }, "uploadedAt": { "type": "string", "format": "date-time" } } },
      "TodoCommentResponse": { "type": "object", "properties": { "id": { "type": "integer" }, "content": { "type": "string" }, "createdAt": { "type": "string", "format": "date-time" }, "updatedAt": { "type": "string", "format": "date-time" }, "userId": { "type": "integer" }, "userName": { "type": "string" } } },
      "TodoCategoryResponse": { "type": "object", "properties": { "id": { "type": "integer" }, "name": { "type": "string" }, "colorCode": { "type": "string" }, "icon": { "type": "string" } } },
      "CreateUserRequest": { "type": "object", "properties": { "username": { "type": "string" }, "email": { "type": "string" }, "password": { "type": "string" }, "role": { "type": "string" } }, "required": ["username","email","password","role"] },
      "UserListItemDto": { "type": "object", "properties": { "id": { "type": "integer" }, "username": { "type": "string" }, "email": { "type": "string" }, "role": { "type": "string" }, "createdAt": { "type": "string", "format": "date-time" } } }
    }
  },
  "paths": {
    "/api/auth/login": { "post": { "summary": "使用者登入", "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/LoginRequest" } } } }, "responses": { "200": { "description": "AuthResponse", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/AuthResponse" } } } }, "401": { "description": "Unauthorized" } } } },
    "/api/auth/register": { "post": { "summary": "使用者註冊", "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RegisterRequest" } } } }, "responses": { "200": { "description": "User created" }, "409": { "description": "Conflict" } } } },
    "/api/auth/refresh": { "post": { "summary": "刷新 Token", "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/RefreshTokenRequest" } } } }, "responses": { "200": { "description": "AuthResponse" }, "401": { "description": "Unauthorized" } } } },
    "/api/auth/me": { "get": { "summary": "取得目前使用者", "security": [{ "bearerAuth": [] }], "responses": { "200": { "description": "UserInfo", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/UserInfo" } } } }, "401": { "description": "Unauthorized" } } } },

    "/api/lookup/projects": { "get": { "summary": "取得專案列表", "security": [{ "bearerAuth": [] }], "responses": { "200": { "description": "List<LookupItemDto>", "content": { "application/json": { "schema": { "type": "array", "items": { "$ref": "#/components/schemas/LookupItemDto" } } } } } } } },

    "/api/worklogs": {
      "get": { "summary": "查詢工作紀錄", "security": [{ "bearerAuth": [] }], "parameters": [{ "name": "page", "in": "query", "schema": { "type": "integer" } }, { "name": "pageSize", "in": "query", "schema": { "type": "integer" } }, { "name": "startDate", "in": "query", "schema": { "type": "string", "format": "date" } }, { "name": "endDate", "in": "query", "schema": { "type": "string", "format": "date" } }], "responses": { "200": { "description": "Paged WorkLogResponse" } } },
      "post": { "summary": "新增工作紀錄", "security": [{ "bearerAuth": [] }], "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/WorkLogRequest" } } } }, "responses": { "201": { "description": "Created" }, "400": { "description": "BadRequest" } } }
    },
    "/api/worklogs/{id}": {
      "get": { "summary": "取得工作紀錄", "security": [{ "bearerAuth": [] }], "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "WorkLogResponse", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/WorkLogResponse" } } } }, "404": { "description": "NotFound" } } },
      "put": { "summary": "更新工作紀錄", "security": [{ "bearerAuth": [] }], "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }], "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/WorkLogRequest" } } } }, "responses": { "200": { "description": "Updated" }, "404": { "description": "NotFound" } } },
      "delete": { "summary": "刪除工作紀錄", "security": [{ "bearerAuth": [] }], "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }], "responses": { "204": { "description": "NoContent" }, "404": { "description": "NotFound" } } }
    },

    "/api/todos": { "get": { "summary": "查詢待辦事項", "security": [{ "bearerAuth": [] }], "responses": { "200": { "description": "Paged Todo" } } , "post": { "summary": "新增待辦", "security": [{ "bearerAuth": [] }], "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TodoRequest" } } } }, "responses": { "201": { "description": "Created" } } } },

    "/api/todos/{id}": { "get": { "summary": "取得待辦", "security": [{ "bearerAuth": [] }], "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "TodoItemResponse", "content": { "application/json": { "schema": { "$ref": "#/components/schemas/TodoItemResponse" } } } }, "404": { "description": "NotFound" } } },

    "/api/todos/{todoId}/subtasks": { "post": { "summary": "新增子任務", "security": [{ "bearerAuth": [] }], "parameters": [{ "name": "todoId", "in": "path", "required": true, "schema": { "type": "integer" } }], "requestBody": { "content": { "application/json": { "schema": { "type": "object", "properties": { "title": { "type": "string" }, "sortOrder": { "type": "integer" } }, "required": ["title"] } } } }, "responses": { "200": { "description": "TodoSubTaskResponse" } } } },

    "/api/todos/{todoId}/attachments": { "post": { "summary": "上傳附件", "security": [{ "bearerAuth": [] }], "parameters": [{ "name": "todoId", "in": "path", "required": true, "schema": { "type": "integer" } }], "requestBody": { "content": { "multipart/form-data": { "schema": { "type": "object", "properties": { "file": { "type": "string", "format": "binary" } }, "required": ["file"] } } } }, "responses": { "200": { "description": "TodoAttachmentResponse" } } } },

    "/api/todocategories": { "get": { "summary": "取得分類列表", "security": [{ "bearerAuth": [] }], "responses": { "200": { "description": "List<TodoCategoryResponse>" } } },
    "/api/todocategories/{id}": { "get": { "summary": "取得分類", "parameters": [{ "name": "id", "in": "path", "required": true, "schema": { "type": "integer" } }], "responses": { "200": { "description": "TodoCategoryResponse" }, "404": { "description": "NotFound" } } } },

    "/api/dataexport/export": { "get": { "summary": "匯出使用者資料（ZIP）", "security": [{ "bearerAuth": [] }], "parameters": [{ "name": "startDate", "in": "query", "schema": { "type": "string", "format": "date" } }, { "name": "endDate", "in": "query", "schema": { "type": "string", "format": "date" } }, { "name": "includeAttachments", "in": "query", "schema": { "type": "boolean" } }], "responses": { "200": { "description": "ZIP file", "content": { "application/zip": { "schema": { "type": "string", "format": "binary" } } } } } } },

    "/api/admin/users": { "get": { "summary": "列出使用者", "security": [{ "bearerAuth": [] }], "responses": { "200": { "description": "List<UserListItemDto>" } } }, "post": { "summary": "建立使用者", "security": [{ "bearerAuth": [] }], "requestBody": { "content": { "application/json": { "schema": { "$ref": "#/components/schemas/CreateUserRequest" } } } }, "responses": { "201": { "description": "Created" } } } }
  }
}
